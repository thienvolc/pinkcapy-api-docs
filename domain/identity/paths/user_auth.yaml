meta: &meta
  $ref: '../../../openapi.yaml#/components/schemas/Meta'
idempotency_key_header: &idempotency_key_header
  $ref: '../../../openapi.yaml#/components/parameters/IdempotencyKeyHeader'

not_found: &not_found
  $ref: '../../../openapi.yaml#/components/responses/NotFound'
bad_request: &bad_request
  $ref: '../../../openapi.yaml#/components/responses/BadRequest'
forbidden: &forbidden
  $ref: '../../../openapi.yaml#/components/responses/Forbidden'
no_content: &no_content
  $ref: '../../../openapi.yaml#/components/responses/NoContent'

tags: &tags
  - User_Auth

register_user_request: &register_user_request
  $ref: '../index.yaml#/components/schemas/RegisterUserRequest'
register_user_response: &register_user_response
  $ref: '../index.yaml#/components/schemas/RegisterUserResponse'
login_request: &login_request
  $ref: '../index.yaml#/components/schemas/LoginRequest'
login_response: &login_response
  $ref: '../index.yaml#/components/schemas/LoginResponse'
forgot_password_request: &forgot_password_request
  $ref: '../index.yaml#/components/schemas/ForgotPasswordRequest'
reset_password_request: &reset_password_request
  $ref: '../index.yaml#/components/schemas/ResetPasswordRequest'
reset_password_token_invalid: &reset_password_token_invalid
  $ref: '../index.yaml#/components/responses/ResetPasswordTokenInvalid'
# ============================================================

paths:
  /users/auth/register:
    post:
      summary: Register a new user
      description: Register a new user in the system.
      tags: *tags
      parameters: [*idempotency_key_header]
      requestBody:
        required: true
        content:
          application/json:
            schema: *register_user_request
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *register_user_response
        '400': *bad_request
  # ============================================================

  /users/auth/login:
    post:
      summary: Login a user
      description: Login a user in the system.
      tags: *tags
      requestBody:
        required: true
        content:
          application/json:
            schema: *login_request
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *login_response
        '400': *bad_request
        '404': *not_found
        '403': *forbidden
  # ============================================================

  /users/auth/logout:
    post:
      summary: Logout a user
      description: Admin to logout a user in the system.
      tags: *tags
      security:
        - bearerAuth: []
      responses:
        '204': *no_content
        '400': *bad_request
        '404': *not_found
        '403': *forbidden
  # ============================================================

  /users/auth/forgot-password:
    post:
      summary: Forgot user password request
      description: Send a password reset email to the user.
      tags: *tags
      requestBody:
        required: true
        content:
          application/json:
            schema: *forgot_password_request
      responses:
        '204': *no_content
        '400': *bad_request
  # ============================================================

  /users/auth/reset-password:
    post:
      summary: Reset user password
      description: Reset the user's password using the provided token.
      tags: *tags
      requestBody:
        required: true
        content:
          application/json:
            schema: *reset_password_request
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data:
                    type: object
                    properties:
                      user_id:
                        type: integer
                        description: 'User id'
                        example: 1
                      email:
                        type: string
                        description: 'Email of the user'
                        example: 'user@example.com'
        '405': *reset_password_token_invalid
        '400': *bad_request
