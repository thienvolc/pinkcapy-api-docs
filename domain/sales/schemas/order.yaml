schemas:
  OrderBase:
    type: object
    description: 'Đơn hàng (Order)'
    properties:
      id:
        type: integer
        readOnly: true
        description: 'Mã đơn hàng'
        example: 1001
      user_id:
        type: integer
        description: 'Mã người dùng'
        example: 25
      subtotal:
        type: number
        format: float
        description: 'Tổng tiền hàng (chưa thuế, phí)'
        example: 12990000.00
      tax:
        type: number
        format: float
        description: 'Thuế'
        example: 1299000.00
      shipping:
        type: number
        format: float
        description: 'Phí vận chuyển'
        example: 30000.00
      total:
        type: number
        format: float
        description: 'Tổng cộng (subtotal + tax + shipping)'
        example: 14319000.00
      discount_total:
        type: number
        format: float
        description: 'Tổng giảm giá'
        example: 500000.00
      promo:
        type: string
        maxLength: 255
        description: 'Mã khuyến mãi áp dụng'
        example: 'SUMMER2025'
      discount:
        type: number
        format: float
        description: 'Giảm giá được áp dụng từ mã khuyến mãi'
        example: 500000.00
      grand_total:
        type: number
        format: float
        description: 'Thành tiền cuối (sau giảm giá)'
        example: 13819000.00
      first_name:
        type: string
        maxLength: 150
        description: 'Họ người nhận'
        example: 'Nguyễn'
      middle_name:
        type: string
        maxLength: 150
        description: 'Tên đệm'
        example: 'Văn'
      last_name:
        type: string
        maxLength: 150
        description: 'Tên người nhận'
        example: 'A'
      phone:
        type: string
        maxLength: 20
        description: 'Số điện thoại người nhận'
        example: '0987654321'
      email:
        type: string
        format: email
        maxLength: 100
        description: 'Email người nhận'
        example: 'nguyenvana@example.com'
      line1:
        type: string
        maxLength: 255
        description: 'Địa chỉ 1'
        example: '123 Nguyễn Trãi'
      line2:
        type: string
        maxLength: 255
        description: 'Địa chỉ 2 (tuỳ chọn)'
        example: 'Phường 4, Quận 5'
      city:
        type: string
        maxLength: 255
        description: 'Thành phố'
        example: 'TP. Hồ Chí Minh'
      province:
        type: string
        maxLength: 255
        description: 'Tỉnh / Thành phố'
        example: 'Hồ Chí Minh'
      country:
        type: string
        maxLength: 255
        description: 'Quốc gia'
        example: 'Việt Nam'
      orders_at:
        type: string
        format: date-time
        description: 'Thời điểm đặt hàng'
        example: '2025-10-31T09:30:00Z'
      status:
        type: string
        enum: [1, 2, 3, 4, 5, 6, 7, 8]
        description: >
          Trạng thái đơn hàng:
          - `pending_payment`: Chờ thanh toán  
          - `paid`: Đã thanh toán  
          - `processing`: Đang xử lý  
          - `shipped`: Đã giao hàng cho đơn vị vận chuyển  
          - `delivered`: Đã giao thành công  
          - `refunded`: Đã hoàn tiền  
          - `returned`: Khách hàng trả hàng  
          - `cancelled`: Đã hủy
        example: 'processing'
      note:
        type: string
        maxLength: 255
        description: 'Ghi chú của khách hàng'
        example: 'Giao buổi sáng, gọi trước khi tới'
    required:
      - id
      - user_id
      - total
      - grand_total
      - status

  OrderItemBase:
    type: object
    description: 'Chi tiết sản phẩm trong đơn hàng (Order Item)'
    properties:
      id:
        type: integer
        description: 'Mã chi tiết đơn hàng'
        example: 10001
      order_id:
        type: integer
        description: 'Mã đơn hàng'
        example: 1001
      product_id:
        type: integer
        description: 'Mã sản phẩm'
        example: 23
      sku:
        type: string
        maxLength: 150
        description: 'Mã SKU của sản phẩm'
        example: 'WH1000XM5-BLK'
      is_active:
        type: boolean
        description: 'Trạng thái hiệu lực của sản phẩm trong đơn'
        example: true
      price:
        type: number
        format: float
        description: 'Giá bán của sản phẩm tại thời điểm đặt hàng'
        example: 8990000.00
      quantity:
        type: integer
        description: 'Số lượng sản phẩm'
        example: 2
      discount:
        type: number
        format: float
        description: 'Số tiền giảm giá áp dụng cho sản phẩm'
        example: 500000.00
      note:
        type: string
        maxLength: 255
        nullable: true
        description: 'Ghi chú cho sản phẩm trong đơn (nếu có)'
        example: 'Gói quà sinh nhật'
    required:
      - order_id
      - product_id
      - price
      - quantity

  UserOrder:
    allOf:
      - $ref: '#/schemas/OrderBase'
      - type: object
        properties:
          user_id:
          items:
            type: array
            description: 'Danh sách sản phẩm trong đơn hàng'
            items:
              $ref: '#/schemas/UserOrderItem'

  UserOrderItem:
    type: object
    description: 'Chi tiết sản phẩm trong đơn hàng (Order Item)'
    allOf:
      - $ref: '#/schemas/OrderItemBase'
      - type: object
        properties:
          sku:
    required:
      - order_id
      - product_id
      - price
      - quantity

  Order:
    allOf:
      - $ref: '#/schemas/OrderBase'
      - $ref: '../../../openapi.yaml#/components/schemas/AuditFields'
      - type: object
        properties:
          items:
            type: array
            description: 'Danh sách chi tiết đơn hàng'
            items:
              $ref: '#/schemas/OrderItemBase'

  ShortOrder:
    type: object
    description: 'Đơn hàng (Order)'
    properties:
      id:
        type: integer
        readOnly: true
        description: 'Mã đơn hàng (khóa chính)'
        example: 1001
      total:
        type: number
        format: float
        description: 'Tổng cộng (subtotal + tax + shipping)'
        example: 14319000.00
      grand_total:
        type: number
        format: float
        description: 'Thành tiền cuối (sau giảm giá)'
        example: 13819000.00
      status:
        type: string
        enum: [1, 2, 3, 4, 5, 6, 7, 8]
        description: >
          Trạng thái đơn hàng:
          - `pending_payment`: Chờ thanh toán  
          - `paid`: Đã thanh toán  
          - `processing`: Đang xử lý  
          - `shipped`: Đã giao hàng cho đơn vị vận chuyển  
          - `delivered`: Đã giao thành công  
          - `refunded`: Đã hoàn tiền  
          - `returned`: Khách hàng trả hàng  
          - `cancelled`: Đã hủy
        example: 'paid'
    required:
      - id
      - user_id
      - total
      - grand_total
      - status

  OrderStatus:
    type: object
    description: 'Trạng thái đơn hàng (Order Status)'
    properties:
      id:
        type: integer
        readOnly: true
        description: 'Mã đơn hàng'
        example: 1001
      status:
        type: integer
        enum: [1, 2, 3, 4, 5, 6, 7, 8]
        description: >
          Trạng thái đơn hàng:
          - `pending_payment`: Chờ thanh toán  
          - `paid`: Đã thanh toán  
          - `processing`: Đang xử lý  
          - `shipped`: Đã giao hàng cho đơn vị vận chuyển  
          - `delivered`: Đã giao thành công  
          - `refunded`: Đã hoàn tiền  
          - `returned`: Khách hàng trả hàng  
          - `cancelled`: Đã hủy
        example: '3'
    required:
      - id
      - status

  OrderDelivery:
    type: object
    description: 'Thông tin giao hàng của đơn hàng'
    properties:
      phone:
        type: string
        maxLength: 20
        description: 'Số điện thoại người nhận'
        example: '0987654321'
      line1:
        type: string
        maxLength: 255
        description: 'Địa chỉ 1'
        example: '123 Nguyễn Trãi'
      line2:
        type: string
        maxLength: 255
        description: 'Địa chỉ 2 (tuỳ chọn)'
        example: 'Phường 4, Quận 5'
      city:
        type: string
        maxLength: 255
        description: 'Thành phố'
        example: 'TP. Hồ Chí Minh'
      province:
        type: string
        maxLength: 255
        description: 'Tỉnh / Thành phố'
        example: 'Hồ Chí Minh'
      country:
        type: string
        maxLength: 255
        description: 'Quốc gia'
        example: 'Việt Nam'
      note:
        type: string
        maxLength: 255
        description: 'Ghi chú của khách hàng'
        example: 'Giao buổi sáng, gọi trước khi tới'

  CreateOrder:
    type: object
    description: 'Đơn hàng (Order)'
    properties:
      promo:
        type: string
        maxLength: 255
        description: 'Mã khuyến mãi áp dụng'
        example: 'SUMMER2025'
      note:
        type: string
        maxLength: 255
        description: 'Ghi chú của khách hàng'
        example: 'Giao buổi sáng, gọi trước khi tới'
      items:
        type: array
        description: 'Danh sách sản phẩm trong đơn hàng'
        items:
          type: integer
          description: 'ID của sản phẩm'
        example: 1
    required:
      - status
