meta: &meta
  $ref: '../../../openapi.yaml#/components/schemas/Meta'
auth_header: &auth_header
  $ref: '../../../openapi.yaml#/components/parameters/AuthorizationHeader'
idempotency_key_header: &idempotency_key_header
  $ref: '../../../openapi.yaml#/components/parameters/IdempotencyKeyHeader'
pagination: &pagination
  $ref: '../../../openapi.yaml#/components/schemas/Pagination'
page_param: &page_param
  $ref: '../../../openapi.yaml#/components/parameters/PageParam'
size_param: &size_param
  $ref: '../../../openapi.yaml#/components/parameters/SizeParam'
sort_param: &sort_param
  $ref: '../../../openapi.yaml#/components/parameters/SortParam'

not_found: &not_found
  $ref: '../../../openapi.yaml#/components/responses/NotFound'
bad_request: &bad_request
  $ref: '../../../openapi.yaml#/components/responses/BadRequest'
forbidden: &forbidden
  $ref: '../../../openapi.yaml#/components/responses/Forbidden'

common_admin: &common_admin
  tags:
    - Product_Admin
  security:
    - bearerAuth: []

product_id: &product_id
  name: id
  in: path
  required: true
  description: ID of the product
  schema: { type: integer, example: 1 }
meta_id: &meta_id
  name: meta_id
  in: path
  required: true
  description: ID of the product meta
  schema: { type: integer, example: 1 }

product: &product
  $ref: '../index.yaml#/components/schemas/Product'
product_meta: &product_meta
  $ref: '../index.yaml#/components/schemas/ProductMeta'
product_tag: &product_tag
  $ref: '../index.yaml#/components/schemas/Tag'
product_tag_ids: &product_tag_ids
  type: object
  properties:
    tag_ids:
      type: array
      items:
        type: integer
      example: [1, 2, 3]

update_product_status_request: &update_product_status_request
  $ref: '../index.yaml#/components/schemas/UpdateProductStatusRequest'
adjust_product_inventory: &adjust_product_inventory
  $ref: '../index.yaml#/components/schemas/AdjustProductInventoryRequest'
# ============================================================

paths:
  /admin/products/{id}:
    get:
      summary: Get product
      description: Retrieve a product by its ID.
      <<: *common_admin
      parameters: [*auth_header, *product_id]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta: *meta
                  data: *product
        '404': *not_found

    put:
      summary: Update a product
      description: Update a product.
      <<: *common_admin
      parameters: [*auth_header, *idempotency_key_header, *product_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *product
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  meta: *meta
                  data: *product
        '400': *bad_request
        '404': *not_found

    delete:
      summary: Delete a product
      description: Delete a product.
      <<: *common_admin
      parameters: [*auth_header, *idempotency_key_header, *product_id]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product
        '400': *bad_request
        '404': *not_found
  # ============================================================

  /admin/products/{id}/metas:
    post:
      summary: Create product meta
      description: Create a new product meta.
      <<: *common_admin
      parameters: [*auth_header, *idempotency_key_header, *product_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *product_meta
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product
        '404': *not_found
  # ============================================================

  /admin/products/{id}/metas/{meta_id}:
    delete:
      summary: Delete a product meta
      description: Delete a product meta.
      <<: *common_admin
      parameters: [*auth_header, *product_id, *meta_id]
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product_meta
        '404': *not_found

    put:
      summary: Update a product meta
      description: Update a product meta.
      <<: *common_admin
      parameters: [*auth_header, *product_id, *meta_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *product_meta
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product_meta
        '404': *not_found
  # ============================================================

  /admin/products/{id}/tags:
    patch:
      summary: Update tags for a product
      description: Update tags for a product.
      <<: *common_admin
      parameters: [*auth_header, *product_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *product_tag_ids
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data:
                    type: object
                    properties:
                      product_id:
                        type: integer
                        example: 1
                      tags:
                        type: array
                        items: *product_tag
        '404': *not_found
  # ============================================================

  /admin/products/{id}/categories:
    put:
      summary: Update categories of a product
      description: Update categories of a product.
      <<: *common_admin
      parameters: [*auth_header, *product_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *product_tag_ids
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product
        '404': *not_found
  # ============================================================

  /admin/products/{id}/status:
    patch:
      summary: Update a product status
      description: Update a product status.
      <<: *common_admin
      parameters: [*auth_header, *idempotency_key_header, *product_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *update_product_status_request
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *update_product_status_request
        '400': *bad_request
        '404': *not_found
  # ============================================================

  /admin/products:
    post:
      summary: Create a new product
      description: Create a new product.
      <<: *common_admin
      parameters: [*auth_header, *idempotency_key_header]
      requestBody:
        required: true
        content:
          application/json:
            schema: *product
      responses:
        '201':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product
        '400': *bad_request
        '404': *not_found
        '403': *forbidden

    get:
      summary: Search products
      description: Retrieve a list of products based on search criteria.
      <<: *common_admin
      parameters:
        - *auth_header
        - *page_param
        - *size_param
        - *sort_param
        - name: query
          in: query
          description: Search keyword
          schema:
            type: string
            example: 1
        - name: category
          in: query
          description: Category ID of the products
          schema:
            type: integer
            example: 1
        - name: price_min
          in: query
          description: Minimum price of the products
          schema:
            type: integer
            example: 0
        - name: price_max
          in: query
          description: Maximum price of the products
          schema:
            type: integer
            example: 10000000
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data:
                    type: object
                    allOf:
                      - *pagination
                      - type: object
                        properties:
                          data:
                            type: array
                            items: *product
  # ============================================================

  /admin/products/{id}/inventories:
    patch:
      summary: Update a product stock
      description: Admin to update an stock of product.
      <<: *common_admin
      parameters: [*auth_header, *idempotency_key_header, *product_id]
      requestBody:
        required: true
        content:
          application/json:
            schema: *adjust_product_inventory
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                properties:
                  meta: *meta
                  data: *product
        '404': *not_found
